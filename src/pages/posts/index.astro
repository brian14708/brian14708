---
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";

const posts = (await getCollection("posts"))
  .filter((p) => !p.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const formatDate = (date: Date) =>
  date.toLocaleDateString("en-US", {
    year: "numeric",
    month: "short",
    day: "numeric",
  });
---

<Layout title="Posts" description="All blog posts">
  <main class="mx-auto max-w-2xl px-6 py-24 lg:px-8 lg:py-32">
    <h1
      class="text-xs font-medium tracking-[0.2em] text-stone-400 uppercase dark:text-stone-500"
    >
      All Posts
    </h1>

    {
      posts.length > 0 ? (
        <ul class="mt-6 space-y-4">
          {posts.map((post) => (
            <li>
              <a
                href={`/posts/${post.id.replace(/\.md$/, "")}/`}
                class="group -mx-3 block rounded-lg px-3 py-3 transition-all duration-300 hover:bg-stone-100/50 dark:hover:bg-stone-800/30"
              >
                <div class="flex items-baseline justify-between gap-4">
                  <h2 class="font-medium text-stone-900 transition-colors duration-300 group-hover:text-stone-600 dark:text-stone-100 dark:group-hover:text-stone-300">
                    {post.data.title}
                  </h2>
                  <time class="shrink-0 text-xs text-stone-400 tabular-nums dark:text-stone-500">
                    {formatDate(post.data.date)}
                  </time>
                </div>
                {post.data.description && (
                  <p class="mt-1 line-clamp-1 text-sm text-stone-500 dark:text-stone-400">
                    {post.data.description}
                  </p>
                )}
              </a>
            </li>
          ))}
        </ul>
      ) : (
        <p class="mt-6 text-sm text-stone-500 dark:text-stone-400">
          No posts yet.
        </p>
      )
    }
  </main>
</Layout>
